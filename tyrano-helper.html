<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <title>tyrano helper</title>
  <script src="https://unpkg.com/vue@next"></script>
</head>

<body>
<!-- ====================================================================== -->
  <div id="app">
    <p>input</p>
    <textarea v-model="inputArea"></textarea>
    <p>output</p>
    <textarea v-model="outputArea"></textarea>
  </div>
  <style>
  textarea {
    display: inline-block;
    vertical-align: top;
    width: 100%;
    height: 8em;
    padding: 8px;
    box-sizing: border-box;
    border-radius: 5px;
    border: 1px solid #e5e5e5;
    outline: none;
    line-height: 1.6;
    resize: vertical;
  }
  </style>
  <script type="text/javascript">
    const TyranoConverter = {
      components: {},
      setup() {
        const inputArea = Vue.ref('')
        const outputArea = Vue.computed(() => {
          const lines = inputArea.value.split('\n')
          const result = []
          const character = {}
          console.log(lines)
          for (const line of lines) {
            let match
            if (line.length === 0) {console.log('空行'); result.push(line) }
            else if (match = /^\s*[＜<](.*)[＞>]\s*$/.exec(line)) {console.log('指示'); result.push(`; ${match[1]}`) }
            else if (match = /^\s*([^＜<]+)[「『]([^」』]+)[」』]\s*$/.exec(line)) {
              if (!character.hasOwnProperty(match[1])) {
                const num = Object.keys(character).length
                const key = `chara${num}`
                character[match[1]] = key
              }
              result.push(`#${character[match[1]]}\n${match[2]}`)
            }
            else { result.push(`${line}[l][r]`) }
          }
          return result.join('\n') 
        })


        return {
          inputArea,
          outputArea,
        }
      },
    }

    Vue.createApp(TyranoConverter).mount('#app')
  </script>
</body>
</html>